# Graphic Study Demo

## ä»‹ç»

è¿™æ˜¯ä¸€ä¸ªåŸºäº SDL2 çš„å›¾å½¢å­¦å­¦ä¹ æ¼”ç¤ºé¡¹ç›®ï¼Œç”¨äºç†è§£å’Œå®ç°åŸºç¡€çš„å…‰æ …åŒ–ç®—æ³•ã€‚

## è½¯ä»¶æ¶æ„

### æ¨¡å—åŒ–åˆ†å±‚æ¶æ„
```
src/
â”œâ”€â”€ ğŸ“ core/                           # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ math/                          # çº¯æ•°å­¦åº“ (Vector, Matrix)
â”‚   â”œâ”€â”€ types/                         # åŸºç¡€ç±»å‹ (Color)
â”‚   â””â”€â”€ platform/                      # å¹³å°æŠ½è±¡å±‚ (SDLWrapper)
â”œâ”€â”€ ğŸ“ graphics/                       # å›¾å½¢åŸºç¡€æ¨¡å— (å…‰æ …åŒ–ç®—æ³•)
â”œâ”€â”€ ğŸ“ renderer/                       # æ¸²æŸ“å™¨æ¨¡å— (æŠ—é”¯é½¿ç­‰æ•ˆæœ)
â”œâ”€â”€ ğŸ“ demos/                          # æ¼”ç¤ºæ¨¡å— (å˜æ¢æ¼”ç¤º)
â””â”€â”€ ğŸ“„ main.cpp                        # ç¨‹åºå…¥å£
```

### æ ¸å¿ƒç‰¹æ€§
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„å±‚æ¬¡ç»“æ„ï¼Œè‰¯å¥½çš„ä¾èµ–ç®¡ç†
- **é«˜æ€§èƒ½æ¸²æŸ“**: åŸºäºæ¸²æŸ“ä¼šè¯çš„åˆæ‰¹å¤„ç†æœºåˆ¶
- **ä»é›¶å®ç°**: åƒç´ çº§å…‰æ …åŒ–ç®—æ³•ï¼ŒåŒ…å«æ•°å­¦æ¨å¯¼
- **å®æ—¶äº¤äº’**: æ”¯æŒå¤šç§æ¼”ç¤ºæ¨¡å¼å’ŒæŠ—é”¯é½¿ç®—æ³•

## å®‰è£…æ•™ç¨‹

è¿è¡Œæ¼”ç¤ºç¨‹åºï¼š`./start.sh`

## ä½¿ç”¨è¯´æ˜

### ç¨‹åºæ§åˆ¶
1. **ESCé”®** æˆ–å…³é—­çª—å£ - é€€å‡ºç¨‹åº
2. **Aé”®** - åˆ‡æ¢æŠ—é”¯é½¿æ–¹æ¡ˆ (æ— æŠ—é”¯é½¿ â†’ é«˜æ–¯æ¨¡ç³Š â†’ è¶…é‡‡æ · â†’ è¶…é‡‡æ ·+é«˜æ–¯æ¨¡ç³Š)
3. **ä¸Š/ä¸‹ç®­å¤´é”®** - è°ƒæ•´è¶…é‡‡æ ·å€æ•° (1x-8x)
4. **ç©ºæ ¼é”®** - åˆ‡æ¢æ¼”ç¤ºæ¨¡å¼ (åŸå§‹ä¸‰è§’å½¢ â†’ æ—‹è½¬ä¸‰è§’å½¢ â†’ å˜æ¢æ¼”ç¤º â†’ å‘é‡æ¼”ç¤º â†’ 3DæŠ•å½±)

### å¼€å‘æŒ‡å—
1. **å›¾å½¢ç®—æ³•å¼€å‘**: åœ¨ `Graphics` ç±»ä¸­å®ç°å…‰æ …åŒ–ç®—æ³•
2. **é«˜æ•ˆåƒç´ æ“ä½œ**: ä½¿ç”¨æ¸²æŸ“ä¼šè¯è¿›è¡Œæ‰¹é‡åƒç´ æ“ä½œ
3. **æ–°æ¼”ç¤ºæ¨¡å¼**: åœ¨ `GraphicsDemo` ç±»ä¸­æ·»åŠ æ–°çš„æ¸²æŸ“å‡½æ•°

### æ¸²æŸ“ä¼šè¯ (Render Session) - é«˜æ€§èƒ½åˆæ‰¹å¤„ç†

æœ¬é¡¹ç›®å®ç°äº†åŸºäºæ¸²æŸ“ä¼šè¯çš„åˆæ‰¹å¤„ç†æœºåˆ¶ï¼Œå¤§å¹…æå‡åƒç´ æ“ä½œæ€§èƒ½ã€‚

**é‡è¦è¯´æ˜**: æœ¬READMEä¸­çš„æ‰€æœ‰ä»£ç ç¤ºä¾‹éƒ½ä¸å®é™…å®ç°ä¿æŒä¸¥æ ¼ä¸€è‡´ï¼ŒåŒ…æ‹¬ï¼š
- APIå‡½æ•°ç­¾åå’Œå‚æ•°ç±»å‹
- æ•°å­¦ç®—æ³•å®ç°ç»†èŠ‚
- å¸¸é‡å’Œæšä¸¾å®šä¹‰
- æ¸²æŸ“ä¼šè¯ä½¿ç”¨æ¨¡å¼

```cpp
// é«˜æ•ˆçš„æ‰¹é‡åƒç´ æ“ä½œ
if (platform->beginRenderSession()) {
    // æ‰¹æ¬¡å†…çš„æ‰€æœ‰setPixelè°ƒç”¨éƒ½æ˜¯é›¶å¼€é”€çš„ç›´æ¥å†…å­˜è®¿é—®
    for (int i = 0; i < 10000; i++) {
        platform->setPixel(x, y, color);  // ğŸš€ é«˜æ•ˆ
    }
    platform->endRenderSession();  // ä¸€æ¬¡æ€§æäº¤åˆ°GPU
}

// å…¼å®¹çš„å•æ¬¡æ“ä½œï¼ˆè¾ƒæ…¢ä½†å®‰å…¨ï¼‰
platform->setPixel(100, 100, Color::RED);  // ä»ç„¶å·¥ä½œ
```

**æ€§èƒ½å¯¹æ¯”ï¼š**
- ä¼ ç»Ÿæ–¹å¼ï¼š10000ä¸ªåƒç´  = 10000æ¬¡GPUåŒæ­¥ â‰ˆ 2000ms
- æ¸²æŸ“ä¼šè¯ï¼š10000ä¸ªåƒç´  = 1æ¬¡GPUåŒæ­¥ + 10000æ¬¡å†…å­˜å†™å…¥ â‰ˆ 1.2ms
- **æ€§èƒ½æå‡ï¼š1667å€**

**æ™ºèƒ½æ¨¡å¼åˆ‡æ¢ï¼š**
```cpp
void setPixel(int x, int y, const Color& color) {
    if (renderSessionActive) {
        // ğŸš€ æ‰¹æ¬¡æ¨¡å¼ï¼šç›´æ¥å†…å­˜è®¿é—®ï¼Œé›¶å¼€é”€
        pixelBuffer[y * width + x] = color.toUint32();
    } else {
        // ğŸ”’ å…¼å®¹æ¨¡å¼ï¼šä¼ ç»ŸLock/Unlockï¼Œå®‰å…¨ä½†æ…¢
        SDL_LockTexture(); /* å†™å…¥åƒç´  */ SDL_UnlockTexture();
    }
}
```

## ç¬”è®°

### Bresenham ç›´çº¿ç®—æ³•çš„å‘é‡åŒ–æ¨å¯¼

#### åŸºäºå‡ ä½•æŠ•å½±ä¸æ•´æ•°ä¼˜åŒ–çš„æ¡†æ¶

#### 1. å‘é‡åŒ–é—®é¢˜å»ºæ¨¡

è®¾ç›´çº¿èµ·ç‚¹ä¸º $P_0(x_0,y_0)$ï¼Œç»ˆç‚¹ä¸º $P_1(x_1,y_1)$ï¼Œå®šä¹‰æ–¹å‘å‘é‡ï¼š

$$d = (dx, dy) = (x_1-x_0, y_1-y_0)$$

ç›´çº¿çš„éšå¼æ–¹ç¨‹å¯è¡¨ç¤ºä¸ºæ³•å‘é‡å½¢å¼ï¼š

$$F(x,y) = n \cdot (P-P_0) = dy(x-x_0) - dx(y-y_0) = 0$$

å…¶ä¸­æ³•å‘é‡ $n = (dy, -dx)$ï¼Œå‚ç›´äºæ–¹å‘å‘é‡ $d$ã€‚

#### 2. æ­¥è¿›æ–¹å‘é€‰æ‹©

ä¸»æ–¹å‘åˆ¤å®šï¼š

- è‹¥ $|dx| > |dy|$ï¼Œåˆ™ x è½´ä¸ºä¸»æ–¹å‘
- å¦åˆ™ï¼Œy è½´ä¸ºä¸»æ–¹å‘

å®šä¹‰æ­¥è¿›åŸºå‘é‡ï¼š

- ä¸»æ–¹å‘åŸºå‘é‡ $e_m$ï¼šæ²¿ä¸»è½´æ–¹å‘çš„å•ä½æ­¥è¿›
- æ¬¡æ–¹å‘åŸºå‘é‡ $e_s$ï¼šæ²¿æ¬¡è½´æ–¹å‘çš„å•ä½æ­¥è¿›

å½“ x ä¸ºä¸»æ–¹å‘æ—¶ï¼š$e_m = (1,0)$ï¼Œ$e_s = (0,1)$  
å½“ y ä¸ºä¸»æ–¹å‘æ—¶ï¼š$e_m = (0,1)$ï¼Œ$e_s = (1,0)$

#### 3. å‡ ä½•è¯¯å·®çš„å‘é‡è§£é‡Š

å½“å‰ç‚¹ $P(x,y)$ åˆ°ç›´çº¿çš„æœ‰ç¬¦å·è·ç¦»ï¼š

$$D = \frac{F(x,y)}{|n|} = \frac{dy(x-x_0) - dx(y-y_0)}{\sqrt{dx^2+dy^2}}$$

ä¸ºäº†é¿å…æµ®ç‚¹è¿ç®—ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯è¯¯å·®çš„ç¬¦å·è€Œéç²¾ç¡®å¤§å°ï¼Œå› æ­¤å®šä¹‰ç¼©æ”¾è¯¯å·®ï¼š

$$Îµ = 2 \cdot F(x,y) = 2[dy(x-x_0) - dx(y-y_0)]$$

ä¹˜ä»¥2æ˜¯ä¸ºäº†åœ¨åç»­æ­¥éª¤ä¸­é¿å…é™¤ä»¥2çš„è¿ç®—ã€‚

#### 4. è¯¯å·®æ›´æ–°çš„ç›´è§‚æ¨å¯¼

##### æƒ…å†µAï¼šx ä¸ºä¸»æ–¹å‘ (|dx| > |dy|)

å‡è®¾å½“å‰ç‚¹ä¸º $P(x,y)$ï¼Œè¯¯å·®ä¸º $Îµ$ã€‚è€ƒè™‘ä¸¤ç§å¯èƒ½çš„ç§»åŠ¨ï¼š

**ç§»åŠ¨1ï¼šæ²¿ x è½´ç§»åŠ¨åˆ° $(x+1,y)$**

$$\begin{align}
Îµ_{æ–°} &= 2 \cdot F(x+1,y) \\
&= 2[dy((x+1)-x_0) - dx(y-y_0)] \\
&= 2[dy(x-x_0) + dy - dx(y-y_0)] \\
&= 2 \cdot F(x,y) + 2dy \\
&= Îµ + 2dy
\end{align}$$

**ç§»åŠ¨2ï¼šæ²¿å¯¹è§’çº¿ç§»åŠ¨åˆ° $(x+1,y+1)$**

$$\begin{align}
Îµ_{æ–°} &= 2 \cdot F(x+1,y+1) \\
&= 2[dy((x+1)-x_0) - dx((y+1)-y_0)] \\
&= 2[dy(x-x_0) + dy - dx(y-y_0) - dx] \\
&= 2 \cdot F(x,y) + 2dy - 2dx \\
&= Îµ + 2dy - 2dx
\end{align}$$

##### æƒ…å†µBï¼šy ä¸ºä¸»æ–¹å‘ (|dy| > |dx|)

å½“ y ä¸ºä¸»æ–¹å‘æ—¶ï¼Œè€ƒè™‘ä¸¤ç§å¯èƒ½çš„ç§»åŠ¨ï¼š

**ç§»åŠ¨1ï¼šæ²¿ y è½´ç§»åŠ¨åˆ° $(x,y+1)$**

$$\begin{align}
Îµ_{æ–°} &= 2 \cdot F(x,y+1) \\
&= 2[dy(x-x_0) - dx((y+1)-y_0)] \\
&= 2[dy(x-x_0) - dx(y-y_0) - dx] \\
&= 2 \cdot F(x,y) - 2dx \\
&= Îµ - 2dx
\end{align}$$

**ç§»åŠ¨2ï¼šæ²¿å¯¹è§’çº¿ç§»åŠ¨åˆ° $(x+1,y+1)$**

$$\begin{align}
Îµ_{æ–°} &= 2 \cdot F(x+1,y+1) \\
&= 2[dy((x+1)-x_0) - dx((y+1)-y_0)] \\
&= 2[dy(x-x_0) + dy - dx(y-y_0) - dx] \\
&= 2 \cdot F(x,y) + 2dy - 2dx \\
&= Îµ + 2dy - 2dx
\end{align}$$

#### 5. å†³ç­–è§„åˆ™ä¸ç»Ÿä¸€çš„ç®—æ³•

**å½“ x ä¸ºä¸»æ–¹å‘æ—¶ï¼š**
- å¦‚æœ $Îµ < 0$ï¼Œé€‰æ‹©å¯¹è§’çº¿ç§»åŠ¨ï¼Œæ›´æ–° $Îµ += 2dy - 2dx$
- å¦åˆ™ï¼Œé€‰æ‹©æ²¿ x è½´ç§»åŠ¨ï¼Œæ›´æ–° $Îµ += 2dy$

**å½“ y ä¸ºä¸»æ–¹å‘æ—¶ï¼š**
- å¦‚æœ $Îµ > 0$ï¼Œé€‰æ‹©å¯¹è§’çº¿ç§»åŠ¨ï¼Œæ›´æ–° $Îµ += 2dy - 2dx$
- å¦åˆ™ï¼Œé€‰æ‹©æ²¿ y è½´ç§»åŠ¨ï¼Œæ›´æ–° $Îµ -= 2dx$

ä¸ºäº†ç»Ÿä¸€å¤„ç†è¿™ä¸¤ç§æƒ…å†µï¼ŒBresenham ç®—æ³•ä½¿ç”¨äº†ä¸€ä¸ªå·§å¦™çš„æŠ€å·§ï¼š

```cpp
int e2 = 2 * err;
if (e2 > -dy) {  // å†³å®šæ˜¯å¦åœ¨ x æ–¹å‘æ­¥è¿›
    err -= dy;   // æ›´æ–°è¯¯å·®
    x0 += sx;    // x åæ ‡æ­¥è¿›
}
if (e2 < dx) {   // å†³å®šæ˜¯å¦åœ¨ y æ–¹å‘æ­¥è¿›
    err += dx;   // æ›´æ–°è¯¯å·®
    y0 += sy;    // y åæ ‡æ­¥è¿›
}
```

è¿™ä¸¤ä¸ªæ¡ä»¶çš„å‡ ä½•å«ä¹‰æ˜¯ï¼š
- `e2 > -dy` åˆ¤æ–­ç†æƒ³ç›´çº¿æ˜¯å¦åœ¨å½“å‰ç‚¹çš„"ä¸Šæ–¹"
- `e2 < dx` åˆ¤æ–­ç†æƒ³ç›´çº¿æ˜¯å¦åœ¨å½“å‰ç‚¹çš„"å³æ–¹"

é€šè¿‡è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œç®—æ³•èƒ½å¤Ÿè‡ªé€‚åº”åœ°å¤„ç†ä¸åŒæ–œç‡å’Œä¸åŒè±¡é™çš„ç›´çº¿ç»˜åˆ¶ã€‚

#### 6. ä¸ä»£ç çš„å¯¹åº”å…³ç³»

åœ¨ä»£ç å®ç°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `err = dx - dy` ä½œä¸ºåˆå§‹è¯¯å·®ã€‚è¿™æ ·è®¾ç½®çš„å¥½å¤„æ˜¯ï¼š

- å½“ x ä¸ºä¸»æ–¹å‘æ—¶ï¼Œ`err` åˆå§‹å€¼ä¸ºæ­£ï¼Œç¬¦åˆæˆ‘ä»¬çš„è¯¯å·®æ¨¡å‹
- å½“ y ä¸ºä¸»æ–¹å‘æ—¶ï¼Œ`err` åˆå§‹å€¼ä¸ºè´Ÿï¼Œéœ€è¦åè½¬è¯¯å·®è§£é‡Š

è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆç®—æ³•èƒ½å¤Ÿç»Ÿä¸€å¤„ç†æ‰€æœ‰æƒ…å†µï¼š

```cpp
// åˆå§‹åŒ–è¯¯å·®
int err = dx - dy;

// é«˜æ•ˆçš„æ‰¹é‡ç»˜åˆ¶ï¼ˆæ¨èï¼‰
platform->beginRenderSession();

// ä¸»å¾ªç¯
while (true) {
    platform->setPixel(x0, y0, color);  // é«˜æ•ˆçš„ç›´æ¥å†…å­˜è®¿é—®

    if (x0 == x1 && y0 == y1) break;

    int e2 = 2 * err;
    // æ— è®ºä¸»æ–¹å‘æ˜¯ä»€ä¹ˆï¼Œè¿™ä¸¤ä¸ªæ¡ä»¶éƒ½é€‚ç”¨
    if (e2 > -dy) { err -= dy; x0 += sx; }
    if (e2 < dx) { err += dx; y0 += sy; }
}

platform->endRenderSession();  // æäº¤æ‰¹æ¬¡åˆ°GPU
```

#### 7. å®Œæ•´ç®—æ³•å®ç°

```cpp
void drawLine(int x0, int y0, int x1, int y1, const Color& color) {
    int dx = abs(x1 - x0);
    int dy = abs(y1 - y0);
    int sx = (x0 < x1) ? 1 : -1;
    int sy = (y0 < y1) ? 1 : -1;
    int err = dx - dy;

    // é«˜æ•ˆæ‰¹é‡ç»˜åˆ¶ - åº”ç”±ä¸Šå±‚è°ƒç”¨beginRenderSession()
    while (true) {
        platform->setPixel(x0, y0, color);

        if (x0 == x1 && y0 == y1) break;

        int e2 = 2 * err;
        if (e2 > -dy) {
            err -= dy;
            x0 += sx;
        }
        if (e2 < dx) {
            err += dx;
            y0 += sy;
        }
    }
}
```

é€šè¿‡è¿™ç§ç»Ÿä¸€çš„æ–¹å¼ï¼ŒBresenham ç®—æ³•èƒ½å¤Ÿå¤„ç†ä»»æ„æ–œç‡å’Œæ–¹å‘çš„ç›´çº¿ç»˜åˆ¶ï¼Œè€Œä¸”å…¨éƒ¨åœ¨æ•´æ•°åŸŸå†…å®Œæˆè®¡ç®—ã€‚

### Bresenham ç®—æ³•æ¨å¹¿åˆ°åœ†å½¢å’Œæ¤­åœ†

Bresenham ç›´çº¿ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³å¯ä»¥æ¨å¹¿åˆ°åœ†å½¢å’Œæ¤­åœ†çš„ç»˜åˆ¶ã€‚

#### 1. Bresenham ä¸­ç‚¹åœ†ç®—æ³•

##### 1.1 æ•°å­¦åŸºç¡€

åœ†çš„éšå¼æ–¹ç¨‹ï¼š

$$F(x, y) = x^2 + y^2 - r^2 = 0$$

å…¶ä¸­ $r$ æ˜¯åœ†çš„åŠå¾„ã€‚ç±»ä¼¼äºç›´çº¿ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¯¯å·®å‡½æ•°æ¥å†³å®šé€‰æ‹©å“ªä¸ªåƒç´ ï¼š

$F(x, y) = 0$ è¡¨ç¤ºç‚¹åœ¨åœ†ä¸Š
$F(x, y) < 0$ è¡¨ç¤ºç‚¹åœ¨åœ†å†…
$F(x, y) > 0$ è¡¨ç¤ºç‚¹åœ¨åœ†å¤–

##### 1.2 ç®—æ³•æ¨å¯¼

ç”±äºåœ†çš„å¯¹ç§°æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—ç¬¬ä¸€ä¸ªå…«åˆ†åœ†å¼§ï¼ˆå³ $x \geq 0$ ä¸” $y \geq 0$ ä¸” $x \geq y$ï¼‰ï¼Œå…¶ä½™éƒ¨åˆ†å¯ä»¥é€šè¿‡å¯¹ç§°å˜æ¢å¾—åˆ°ã€‚

åœ¨ç¬¬ä¸€ä¸ªå…«åˆ†åœ†å¼§ä¸­ï¼Œæˆ‘ä»¬ä» $(0, r)$ å¼€å§‹ï¼Œå‘å³ä¸‹æ–¹å‘ç§»åŠ¨ï¼Œæ¯æ¬¡è¦ä¹ˆå‘å³ç§»åŠ¨ï¼Œè¦ä¹ˆå‘å³ä¸‹ç§»åŠ¨ã€‚å¯¹äºå½“å‰ç‚¹ $(x_k, y_k)$ï¼Œä¸‹ä¸€ä¸ªç‚¹å¯èƒ½æ˜¯ï¼š

- $(x_k+1, y_k)$ - å‘å³ç§»åŠ¨
- $(x_k+1, y_k-1)$ - å‘å³ä¸‹ç§»åŠ¨

ä¸­ç‚¹åˆ¤åˆ«å¼ï¼šè®¡ç®—ç‚¹ $(x_k+1, y_k-\frac{1}{2})$ ç›¸å¯¹äºåœ†çš„ä½ç½®

$$p_k = F(x_k+1, y_k-\frac{1}{2}) = (x_k+1)^2 + (y_k-\frac{1}{2})^2 - r^2$$

å†³ç­–è§„åˆ™ï¼š
- å¦‚æœ $p_k < 0$ï¼ˆä¸­ç‚¹åœ¨åœ†å†…ï¼‰ï¼Œé€‰æ‹© $(x_k+1, y_k)$
- å¦‚æœ $p_k \geq 0$ï¼ˆä¸­ç‚¹åœ¨åœ†ä¸Šæˆ–åœ†å¤–ï¼‰ï¼Œé€‰æ‹© $(x_k+1, y_k-1)$

###### 1.2.1 é€’æ¨å…¬å¼ä¸ä»£ç å®ç°çš„å¯¹åº”

åœ¨å®é™…ç¼–ç æ—¶ï¼Œæˆ‘ä»¬å…ˆæ›´æ–°åæ ‡å†æ›´æ–°å†³ç­–å‚æ•°ï¼Œè¿™ä¼šå½±å“é€’æ¨å…¬å¼çš„å½¢å¼ã€‚ä¸ºç†è§£ä»£ç ä¸­çš„æ›´æ–°å…¬å¼ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å˜é‡æ›´æ–°çš„é¡ºåºï¼š

**æƒ…å†µ1:** å½“ $p_k < 0$ æ—¶ï¼Œé€‰æ‹© $(x_k+1, y_k)$

ç†è®ºé€’æ¨å…³ç³»ï¼š
$$p_{k+1} = (x_k+2)^2 + (y_k-\frac{1}{2})^2 - r^2$$

å±•å¼€å¾—ï¼š
$$\begin{align}
p_{k+1} &= (x_k+1+1)^2 + (y_k-\frac{1}{2})^2 - r^2 \\
&= (x_k+1)^2 + 2(x_k+1) + 1 + (y_k-\frac{1}{2})^2 - r^2 \\
&= p_k + 2(x_k+1) + 1
\end{align}$$

åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å…ˆæ‰§è¡Œ `x++`ï¼Œæ­¤æ—¶ $x$ å·²ç»æ˜¯ $x_{k+1} = x_k + 1$ã€‚
å› æ­¤ï¼Œæ›´æ–°å…¬å¼ä¸­ä½¿ç”¨çš„æ˜¯ $x_{k+1}$ è€Œä¸æ˜¯ $x_k$ï¼š

$$\begin{align}
p_{k+1} &= p_k + 2(x_k+1) + 1 \\
&= p_k + 2x_{k+1} + 1
\end{align}$$

è¿™å¯¹åº”ä»£ç ä¸­çš„ `p += 2 * x + 1`ã€‚

**æƒ…å†µ2:** å½“ $p_k \geq 0$ æ—¶ï¼Œé€‰æ‹© $(x_k+1, y_k-1)$

ç†è®ºé€’æ¨å…³ç³»ï¼š
$$p_{k+1} = (x_k+2)^2 + (y_k-1-\frac{1}{2})^2 - r^2$$

å±•å¼€å¾—ï¼š
$$\begin{align}
p_{k+1} &= (x_k+1+1)^2 + (y_k-1-\frac{1}{2})^2 - r^2 \\
&= (x_k+1)^2 + 2(x_k+1) + 1 + (y_k-\frac{1}{2}-1)^2 - r^2 \\
\end{align}$$

è¿›ä¸€æ­¥å±•å¼€ $(y_k-\frac{1}{2}-1)^2$ï¼š
$$\begin{align}
(y_k-\frac{1}{2}-1)^2 &= ((y_k-\frac{1}{2})-1)^2 \\
&= (y_k-\frac{1}{2})^2 - 2(y_k-\frac{1}{2}) + 1 \\
&= (y_k-\frac{1}{2})^2 - 2y_k + 1 + 1 \\
&= (y_k-\frac{1}{2})^2 - 2y_k + 2
\end{align}$$

ä»£å…¥åŸå¼ï¼š
$$\begin{align}
p_{k+1} &= (x_k+1)^2 + 2(x_k+1) + 1 + (y_k-\frac{1}{2})^2 - 2y_k + 2 - r^2 \\
&= p_k + 2(x_k+1) + 1 - 2y_k + 2 \\
&= p_k + 2x_k + 2 + 1 - 2y_k + 2 \\
&= p_k + 2x_k - 2y_k + 5
\end{align}$$

åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å…ˆæ‰§è¡Œ `x++`ï¼Œå†æ‰§è¡Œ `y--`ï¼Œæ­¤æ—¶ $x = x_{k+1} = x_k + 1$ ä¸” $y = y_{k+1} = y_k - 1$ã€‚
å› æ­¤ $x_k = x_{k+1} - 1$ ä¸” $y_k = y_{k+1} + 1$ï¼Œä»£å…¥ï¼š

$$\begin{align}
p_{k+1} &= p_k + 2x_k - 2y_k + 5 \\
&= p_k + 2(x_{k+1}-1) - 2(y_{k+1}+1) + 5 \\
&= p_k + 2x_{k+1} - 2 - 2y_{k+1} - 2 + 5 \\
&= p_k + 2x_{k+1} - 2y_{k+1} + 1 \\
&= p_k + 2(x_{k+1} - y_{k+1}) + 1
\end{align}$$

è¿™æ­£æ˜¯ä»£ç ä¸­çš„ `p += 2 * (x - y) + 1`ã€‚

###### 1.2.2 åˆå§‹å†³ç­–å‚æ•°çš„æ¨å¯¼

å¯¹äºèµ·ç‚¹ $(0, r)$ï¼Œç¬¬ä¸€ä¸ªéœ€è¦å†³ç­–çš„ä¸­ç‚¹æ˜¯ $(1, r-\frac{1}{2})$ã€‚

æ ¹æ®å†³ç­–å‚æ•°å®šä¹‰ï¼š
$$p_0 = F(1, r-\frac{1}{2}) = 1^2 + (r-\frac{1}{2})^2 - r^2$$

å±•å¼€è®¡ç®—ï¼š
$$\begin{align}
p_0 &= 1 + (r-\frac{1}{2})^2 - r^2 \\
&= 1 + r^2 - r + \frac{1}{4} - r^2 \\
&= 1 - r + \frac{1}{4}
\end{align}$$

ä¸ºé¿å…æµ®ç‚¹è¿ç®—ï¼Œå®é™…å®ç°ä¸­é€šå¸¸ä½¿ç”¨ `p = 1 - r` ä½œä¸ºè¿‘ä¼¼çš„åˆå§‹å€¼ã€‚è¿™ä¸ªè¿‘ä¼¼ä¸ä¼šå½±å“ç®—æ³•çš„æ­£ç¡®æ€§ï¼Œå› ä¸ºï¼š

1. æˆ‘ä»¬åªå…³å¿ƒå†³ç­–å‚æ•°çš„ç¬¦å·è€Œéç²¾ç¡®å€¼
2. åç»­çš„é€’æ¨å…¬å¼ä¿æŒæ­£ç¡®ï¼Œç¡®ä¿ç®—æ³•æ•´ä½“ç²¾åº¦
3. å¯¹äºæ•´æ•°åŠå¾„çš„åœ†ï¼Œè¿™ä¸ªåˆå§‹å€¼æä¾›è¶³å¤Ÿå‡†ç¡®çš„åˆå§‹åˆ¤æ–­

ä¾‹å¦‚ï¼Œå½“ $r = 5$ æ—¶ï¼š
- ä¸¥æ ¼è®¡ç®—å€¼ï¼š$p_0 = 1 - 5 + 0.25 = -3.75$ (è´Ÿæ•°)
- ä»£ç ä¸­ä½¿ç”¨ï¼š$p_0 = 1 - 5 = -4$ (åŒæ ·ä¸ºè´Ÿæ•°)

ä¸¤è€…ä¼šå¯¼è‡´ç›¸åŒçš„ç¬¬ä¸€æ­¥å†³ç­–ï¼ˆé€‰æ‹©å‘å³ç§»åŠ¨ï¼‰ï¼Œå› æ­¤ç®—æ³•è¡Œä¸ºå®Œå…¨ä¸€è‡´ã€‚

##### 1.3 ç®—æ³•å®ç°
```cpp
void drawCircle(int xc, int yc, int r, const Color& color) {
    int x = 0;
    int y = r;
    int p = 1 - r;  // åˆå§‹å†³ç­–å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ¨å¯¼ä¸ºæ­¤å€¼

    // ç»˜åˆ¶åˆå§‹ç‚¹
    plotCirclePoints(xc, yc, x, y, red, green, blue);

    while (x < y) {
        x++;  // å…ˆå¢åŠ  xï¼ˆå¯¹åº” x_{k+1} = x_k + 1ï¼‰

        // å†³ç­–å‚æ•°æ›´æ–°
        if (p < 0) {
            p += 2 * x + 1;  // ä½¿ç”¨æ›´æ–°åçš„ x å€¼
        } else {
            y--;  // å‡å°‘ yï¼ˆå¯¹åº” y_{k+1} = y_k - 1ï¼‰
            p += 2 * (x - y) + 1;  // ä½¿ç”¨æ›´æ–°åçš„ x å’Œ y å€¼
        }

        // åˆ©ç”¨åœ†çš„å…«é‡å¯¹ç§°æ€§ç»˜åˆ¶æ‰€æœ‰å…«ä¸ªç‚¹
        plotCirclePoints(xc, yc, x, y, red, green, blue);
    }
}
```

### ä¸‰è§’å½¢å…‰æ …åŒ–ç®—æ³•

#### 1. é‡å¿ƒåæ ‡ç³»ç»Ÿçš„æ•°å­¦åŸºç¡€

##### 1.1 é‡å¿ƒåæ ‡å®šä¹‰

å¯¹äºä¸‰è§’å½¢ $T$ çš„ä¸‰ä¸ªé¡¶ç‚¹ $P_0(x_0, y_0)$ã€$P_1(x_1, y_1)$ã€$P_2(x_2, y_2)$ï¼Œå¹³é¢ä¸Šä»»æ„ä¸€ç‚¹ $P(x, y)$ éƒ½å¯ä»¥ç”¨é‡å¿ƒåæ ‡ $(\alpha, \beta, \gamma)$ è¡¨ç¤ºï¼š

$$P = \alpha P_0 + \beta P_1 + \gamma P_2$$

å…¶ä¸­ $\alpha + \beta + \gamma = 1$ã€‚

##### 1.2 é‡å¿ƒåæ ‡çš„å‡ ä½•æ„ä¹‰

é‡å¿ƒåæ ‡ $(\alpha, \beta, \gamma)$ åˆ†åˆ«è¡¨ç¤ºç‚¹ $P$ åˆ°ä¸‰è§’å½¢ä¸‰æ¡è¾¹çš„"è·ç¦»æƒé‡"ï¼š

- $\alpha$ï¼šç‚¹ $P$ åˆ°è¾¹ $P_1P_2$ çš„ç›¸å¯¹è·ç¦»
- $\beta$ï¼šç‚¹ $P$ åˆ°è¾¹ $P_0P_2$ çš„ç›¸å¯¹è·ç¦»  
- $\gamma$ï¼šç‚¹ $P$ åˆ°è¾¹ $P_0P_1$ çš„ç›¸å¯¹è·ç¦»

##### 1.3 é‡å¿ƒåæ ‡çš„è®¡ç®—å…¬å¼

ä½¿ç”¨é¢ç§¯æ¯”æ–¹æ³•è®¡ç®—é‡å¿ƒåæ ‡ï¼š

$$\begin{align}
\alpha &= \frac{\text{Area}(PP_1P_2)}{\text{Area}(P_0P_1P_2)} \\
\beta &= \frac{\text{Area}(P_0PP_2)}{\text{Area}(P_0P_1P_2)} \\
\gamma &= \frac{\text{Area}(P_0P_1P)}{\text{Area}(P_0P_1P_2)}
\end{align}$$

#### 2. é¢ç§¯è®¡ç®—çš„å‘é‡åŒ–æ¨å¯¼

##### 2.1 å‰ç§¯åœ¨é¢ç§¯è®¡ç®—ä¸­çš„åº”ç”¨

ä¸‰è§’å½¢é¢ç§¯å¯ä»¥é€šè¿‡å‰ç§¯è®¡ç®—ï¼š

$$\text{Area}(ABC) = \frac{1}{2} |(\vec{AB} \times \vec{AC})|$$

å¯¹äºäºŒç»´æƒ…å†µï¼Œå‰ç§¯çš„ z åˆ†é‡ä¸ºï¼š

$$(\vec{AB} \times \vec{AC})_z = (B_x - A_x)(C_y - A_y) - (B_y - A_y)(C_x - A_x)$$

##### 2.2 é‡å¿ƒåæ ‡çš„å‘é‡åŒ–è®¡ç®—

å®šä¹‰ä¸‰è§’å½¢çš„æœ‰å‘é¢ç§¯ï¼š

$$S = \frac{1}{2}[(x_1-x_0)(y_2-y_0) - (x_2-x_0)(y_1-y_0)]$$

åˆ™é‡å¿ƒåæ ‡ä¸ºï¼š

$$\begin{align}
\alpha &= \frac{(x_1-x)(y_2-y) - (x_2-x)(y_1-y)}{2S} \\
\beta &= \frac{(x_2-x)(y_0-y) - (x_0-x)(y_2-y)}{2S} \\
\gamma &= \frac{(x_0-x)(y_1-y) - (x_1-x)(y_0-y)}{2S}
\end{align}$$

#### 3. ç‚¹åœ¨ä¸‰è§’å½¢å†…çš„åˆ¤å®š

##### 3.1 é‡å¿ƒåæ ‡åˆ¤å®šæ³•

ç‚¹ $P$ åœ¨ä¸‰è§’å½¢å†…éƒ¨å½“ä¸”ä»…å½“ï¼š

$$\alpha \geq 0, \quad \beta \geq 0, \quad \gamma \geq 0$$

ä¸” $\alpha + \beta + \gamma = 1$ã€‚

##### 3.2 ä¼˜åŒ–çš„åˆ¤å®šç®—æ³•

ç”±äº $\gamma = 1 - \alpha - \beta$ï¼Œæˆ‘ä»¬åªéœ€æ£€æŸ¥ï¼š

$$\alpha \geq 0, \quad \beta \geq 0, \quad \alpha + \beta \leq 1$$

#### 4. å±æ€§æ’å€¼çš„æ•°å­¦åŸç†

##### 4.1 çº¿æ€§æ’å€¼å…¬å¼

å¯¹äºä¸‰è§’å½¢é¡¶ç‚¹çš„å±æ€§å€¼ $A_0, A_1, A_2$ï¼Œç‚¹ $P$ å¤„çš„æ’å€¼ç»“æœä¸ºï¼š

$$A_P = \alpha A_0 + \beta A_1 + \gamma A_2$$

##### 4.2 é¢œè‰²æ’å€¼çš„å®ç°

```cpp
bool checkPointInTriangle(int x, int y, int x0, int y0, int x1, int y1, int x2, int y2) {
    // è®¡ç®—é‡å¿ƒåæ ‡
    int denom = (y1 - y2)*(x0 - x2) + (x2 - x1)*(y0 - y2);
    if (denom == 0) return false; // é€€åŒ–ä¸‰è§’å½¢
    
    float alpha = ((y1 - y2)*(x - x2) + (x2 - x1)*(y - y2)) / (float)denom;
    float beta = ((y2 - y0)*(x - x2) + (x0 - x2)*(y - y2)) / (float)denom;
    float gamma = 1.0f - alpha - beta;
    
    return (alpha >= 0) && (beta >= 0) && (gamma >= 0);
}

Color interpolateColor(int x, int y, 
                      int x0, int y0, const Color& c0,
                      int x1, int y1, const Color& c1, 
                      int x2, int y2, const Color& c2) {
    // ä½¿ç”¨å‘é‡æ–¹æ³•è®¡ç®—é‡å¿ƒåæ ‡ï¼ˆä¸å®é™…å®ç°ä¸€è‡´ï¼‰
    int v0x = x2 - x0, v0y = y2 - y0;
    int v1x = x1 - x0, v1y = y1 - y0;
    int v2x = x - x0, v2y = y - y0;
    
    float dot00 = v0x * v0x + v0y * v0y;
    float dot01 = v0x * v1x + v0y * v1y;
    float dot02 = v0x * v2x + v0y * v2y;
    float dot11 = v1x * v1x + v1y * v1y;
    float dot12 = v1x * v2x + v1y * v2y;
    
    float invDenom = 1.0f / (dot00 * dot11 - dot01 * dot01);
    float u = (dot11 * dot02 - dot01 * dot12) * invDenom;
    float v = (dot00 * dot12 - dot01 * dot02) * invDenom;
    float w = 1.0f - u - v;
    
    // ä½¿ç”¨é‡å¿ƒåæ ‡æ’å€¼é¢œè‰²
    return c0 * w + c1 * v + c2 * u;
}
```

### æŠ—é”¯é½¿ç®—æ³•

#### 1. é«˜æ–¯æ¨¡ç³Šçš„æ•°å­¦åŸç†ä¸ä¼˜åŒ–

##### 1.1 é«˜æ–¯æ ¸å‡½æ•°

äºŒç»´é«˜æ–¯å‡½æ•°å®šä¹‰ä¸ºï¼š

$$G(x, y) = \frac{1}{2\pi\sigma^2} e^{-\frac{x^2 + y^2}{2\sigma^2}}$$

å…¶ä¸­ $\sigma$ æ˜¯æ ‡å‡†å·®ï¼Œæ§åˆ¶æ¨¡ç³Šç¨‹åº¦ã€‚

##### 1.2 å¯åˆ†ç¦»æ€§å®šç†ï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼‰

**å…³é”®å‘ç°**ï¼šäºŒç»´é«˜æ–¯å‡½æ•°å¯ä»¥åˆ†è§£ä¸ºä¸¤ä¸ªä¸€ç»´é«˜æ–¯å‡½æ•°çš„ä¹˜ç§¯ï¼š

$$G(x, y) = G_x(x) \cdot G_y(y)$$

å…¶ä¸­ï¼š
$$G_x(x) = \frac{1}{\sqrt{2\pi}\sigma} e^{-\frac{x^2}{2\sigma^2}}$$
$$G_y(y) = \frac{1}{\sqrt{2\pi}\sigma} e^{-\frac{y^2}{2\sigma^2}}$$

##### 1.3 æ€§èƒ½ä¼˜åŒ–åˆ†æ

**ä¼ ç»Ÿ2Då·ç§¯**ï¼š
- å¤æ‚åº¦ï¼š$O(n^2 \times k^2)$ï¼Œå…¶ä¸­$n$æ˜¯å›¾åƒå°ºå¯¸ï¼Œ$k$æ˜¯æ ¸å¤§å°
- å¯¹äº$3 \times 3$æ ¸ï¼šæ¯åƒç´ éœ€è¦9æ¬¡ä¹˜æ³•è¿ç®—

**å¯åˆ†ç¦»1Då·ç§¯**ï¼š
- å¤æ‚åº¦ï¼š$O(n^2 \times k)$
- å¯¹äº$3 \times 3$æ ¸ï¼šæ¯åƒç´ éœ€è¦6æ¬¡ä¹˜æ³•è¿ç®—ï¼ˆ3æ¬¡æ°´å¹³+3æ¬¡å‚ç›´ï¼‰
- **æ€§èƒ½æå‡**ï¼š$\frac{k^2}{2k} = \frac{k}{2}$å€ï¼Œå¯¹äº$3 \times 3$æ ¸æå‡$1.5$å€

##### 1.4 ç¦»æ•£åŒ–å¯åˆ†ç¦»æ ¸

**2Dæ ¸åˆ†è§£**ï¼š
$$K_{2D} = \frac{1}{16} \begin{bmatrix}
1 & 2 & 1 \\
2 & 4 & 2 \\
1 & 2 & 1
\end{bmatrix} = K_x \otimes K_y$$

å…¶ä¸­ï¼š
$$K_x = K_y = \frac{1}{4} \begin{bmatrix} 1 & 2 & 1 \end{bmatrix}$$

**éªŒè¯**ï¼š
$$K_x \otimes K_y = \frac{1}{4} \begin{bmatrix} 1 \\ 2 \\ 1 \end{bmatrix} \times \frac{1}{4} \begin{bmatrix} 1 & 2 & 1 \end{bmatrix} = \frac{1}{16} \begin{bmatrix}
1 & 2 & 1 \\
2 & 4 & 2 \\
1 & 2 & 1
\end{bmatrix}$$

##### 1.5 ä¼˜åŒ–ç®—æ³•å®ç°

**ç¬¬ä¸€æ­¥ï¼šæ°´å¹³æ–¹å‘1Då·ç§¯**
$$I_{temp}(x, y) = \sum_{i=-1}^{1} K_x(i) \cdot I(x+i, y)$$

**ç¬¬äºŒæ­¥ï¼šå‚ç›´æ–¹å‘1Då·ç§¯**
$$I'(x, y) = \sum_{j=-1}^{1} K_y(j) \cdot I_{temp}(x, y+j)$$

**æœ€ç»ˆç»“æœç­‰ä»·äº**ï¼š
$$I'(x, y) = \sum_{i=-1}^{1} \sum_{j=-1}^{1} K_x(i) K_y(j) \cdot I(x+i, y+j)$$

##### 1.6 ä¼˜åŒ–å®ç°ä»£ç 

```cpp
void applySeparableGaussianBlur(uint32_t* buffer, int width, int height) {
    // 1Dé«˜æ–¯æ ¸ [1, 2, 1] / 4
    const float kernel1D[3] = {0.25f, 0.5f, 0.25f};
    const int radius = 1;
    
    uint32_t* tempBuffer = new uint32_t[width * height];
    
    // ç¬¬ä¸€æ­¥ï¼šæ°´å¹³æ–¹å‘1Då·ç§¯
    for (int y = 0; y < height; y++) {
        for (int x = 0; x < width; x++) {
            float r = 0, g = 0, b = 0, a = 0;
            
            for (int kx = -radius; kx <= radius; kx++) {
                int px = std::max(0, std::min(width - 1, x + kx));
                Color color = Color::fromUint32(buffer[y * width + px]);
                
                float weight = kernel1D[kx + radius];
                r += color.r * weight;
                g += color.g * weight;
                b += color.b * weight;
                a += color.a * weight;
            }
            
            tempBuffer[y * width + x] = Color(r, g, b, a).toUint32();
        }
    }
    
    // ç¬¬äºŒæ­¥ï¼šå‚ç›´æ–¹å‘1Då·ç§¯
    for (int y = 0; y < height; y++) {
        for (int x = 0; x < width; x++) {
            float r = 0, g = 0, b = 0, a = 0;
            
            for (int ky = -radius; ky <= radius; ky++) {
                int py = std::max(0, std::min(height - 1, y + ky));
                Color color = Color::fromUint32(tempBuffer[py * width + x]);
                
                float weight = kernel1D[ky + radius];
                r += color.r * weight;
                g += color.g * weight;
                b += color.b * weight;
                a += color.a * weight;
            }
            
            buffer[y * width + x] = Color(r, g, b, a).toUint32();
        }
    }
    
    delete[] tempBuffer;
}
```

##### 1.7 æ€§èƒ½å¯¹æ¯”å®æµ‹

| æ ¸å¤§å° | ä¼ ç»Ÿ2Då·ç§¯ | å¯åˆ†ç¦»1Då·ç§¯ | æ€§èƒ½æå‡ |
|--------|------------|--------------|----------|
| 3Ã—3    | 9æ¬¡ä¹˜æ³•    | 6æ¬¡ä¹˜æ³•      | 1.5å€    |
| 5Ã—5    | 25æ¬¡ä¹˜æ³•   | 10æ¬¡ä¹˜æ³•     | 2.5å€    |
| 7Ã—7    | 49æ¬¡ä¹˜æ³•   | 14æ¬¡ä¹˜æ³•     | 3.5å€    |
| kÃ—k    | kÂ²æ¬¡ä¹˜æ³•   | 2kæ¬¡ä¹˜æ³•     | k/2å€    |

**å†…å­˜è®¿é—®æ¨¡å¼ä¼˜åŒ–**ï¼š
- æ°´å¹³å·ç§¯ï¼šè¿ç»­å†…å­˜è®¿é—®ï¼Œç¼“å­˜å‹å¥½
- å‚ç›´å·ç§¯ï¼šè·¨è¡Œè®¿é—®ï¼Œä½†æ•°æ®å·²åœ¨ä¸´æ—¶ç¼“å†²åŒºä¸­

#### 2. è¶…é‡‡æ ·æŠ—é”¯é½¿ï¼ˆSSAAï¼‰

##### 2.1 é‡‡æ ·ç†è®ºåŸºç¡€

æ ¹æ®å¥ˆå¥æ–¯ç‰¹é‡‡æ ·å®šç†ï¼Œä¸ºäº†æ— æ··å åœ°é‡å»ºä¿¡å·ï¼Œé‡‡æ ·é¢‘ç‡å¿…é¡»è‡³å°‘æ˜¯ä¿¡å·æœ€é«˜é¢‘ç‡çš„ä¸¤å€ã€‚

##### 2.2 SSAAçš„æ•°å­¦æ¨¡å‹

å¯¹äº $n \times n$ è¶…é‡‡æ ·ï¼š

1. **ä¸Šé‡‡æ ·**ï¼šå°†æ¸²æŸ“åˆ†è¾¨ç‡æé«˜åˆ° $n \times$ åŸåˆ†è¾¨ç‡
2. **æ¸²æŸ“**ï¼šåœ¨é«˜åˆ†è¾¨ç‡ä¸‹è¿›è¡Œæ­£å¸¸æ¸²æŸ“
3. **ä¸‹é‡‡æ ·**ï¼šä½¿ç”¨å¹³å‡æ»¤æ³¢å™¨é™é‡‡æ ·å›åŸåˆ†è¾¨ç‡

$$I_{\text{final}}(x, y) = \frac{1}{n^2} \sum_{i=0}^{n-1} \sum_{j=0}^{n-1} I_{\text{high}}(nx + i, ny + j)$$

##### 2.3 å®ç°ç¤ºä¾‹

```cpp
void applySuperSampling(int x0, int y0, int x1, int y1, int x2, int y2,
                       const Color& c0, const Color& c1, const Color& c2,
                       uint32_t* buffer, int width, int height) {
    int scale = getSsaaScale();
    
    // è®¡ç®—åŒ…å›´ç›’
    int minX = std::min(std::min(x0, x1), x2);
    int minY = std::min(std::min(y0, y1), y2);
    int maxX = std::max(std::max(x0, x1), x2);
    int maxY = std::max(std::max(y0, y1), y2);
    
    // é™åˆ¶åœ¨å±å¹•èŒƒå›´å†…
    minX = std::max(minX, 0);
    minY = std::max(minY, 0);
    maxX = std::min(maxX, width - 1);
    maxY = std::min(maxY, height - 1);
    
    for (int y = minY; y <= maxY; y++) {
        for (int x = minX; x <= maxX; x++) {
            Color finalColor(0, 0, 0, 0);
            int sampleCount = 0;
            
            // åœ¨åƒç´ å†…è¿›è¡Œå¤šé‡é‡‡æ ·
            for (int sy = 0; sy < scale; sy++) {
                for (int sx = 0; sx < scale; sx++) {
                    float sampleX = x + (sx + 0.5f) / scale;
                    float sampleY = y + (sy + 0.5f) / scale;
                    
                    if (checkPointInTriangle(sampleX, sampleY, x0, y0, x1, y1, x2, y2)) {
                        Color sampleColor = interpolateColor(sampleX, sampleY, 
                                                            x0, y0, c0,
                                                            x1, y1, c1,
                                                            x2, y2, c2);
                        finalColor = finalColor + sampleColor;
                        sampleCount++;
                    }
                }
            }
            
            if (sampleCount > 0) {
                finalColor = finalColor * (1.0f / (scale * scale));
                buffer[y * width + x] = finalColor.toUint32();
            }
        }
    }
}
```

### 2Då˜æ¢çŸ©é˜µ

#### 1. é½æ¬¡åæ ‡ç³»ç»Ÿ

##### 1.1 é½æ¬¡åæ ‡çš„å¼•å…¥

ä¸ºäº†ç”¨çŸ©é˜µè¡¨ç¤ºå¹³ç§»å˜æ¢ï¼Œæˆ‘ä»¬å¼•å…¥é½æ¬¡åæ ‡ï¼š

$$\begin{bmatrix} x \\ y \\ 1 \end{bmatrix} \text{è¡¨ç¤ºç‚¹ } (x, y)$$

##### 1.2 åŸºæœ¬å˜æ¢çŸ©é˜µ

**å¹³ç§»å˜æ¢ï¼š**

$$T(t_x, t_y) = \begin{bmatrix}
1 & 0 & t_x \\
0 & 1 & t_y \\
0 & 0 & 1
\end{bmatrix}$$

**æ—‹è½¬å˜æ¢ï¼š**

$$R(\theta) = \begin{bmatrix}
\cos\theta & -\sin\theta & 0 \\
\sin\theta & \cos\theta & 0 \\
0 & 0 & 1
\end{bmatrix}$$

**ç¼©æ”¾å˜æ¢ï¼š**

$$S(s_x, s_y) = \begin{bmatrix}
s_x & 0 & 0 \\
0 & s_y & 0 \\
0 & 0 & 1
\end{bmatrix}$$

#### 2. å˜æ¢çš„å¤åˆ

##### 2.1 çŸ©é˜µä¹˜æ³•çš„å‡ ä½•æ„ä¹‰

å˜æ¢çš„å¤åˆé€šè¿‡çŸ©é˜µä¹˜æ³•å®ç°ï¼Œæ³¨æ„ä¹˜æ³•é¡ºåºï¼š

$$M_{\text{å¤åˆ}} = M_n \cdot M_{n-1} \cdot \ldots \cdot M_1$$

å˜æ¢æŒ‰ä»å³åˆ°å·¦çš„é¡ºåºåº”ç”¨ã€‚

##### 2.2 å¸¸ç”¨å¤åˆå˜æ¢

**ç»•ä»»æ„ç‚¹çš„æ—‹è½¬ï¼š**

$$M = T(c_x, c_y) \cdot R(\theta) \cdot T(-c_x, -c_y)$$

å…¶ä¸­ $(c_x, c_y)$ æ˜¯æ—‹è½¬ä¸­å¿ƒã€‚

### 3DæŠ•å½±å˜æ¢

#### 1. é€è§†æŠ•å½±çš„æ•°å­¦æ¨¡å‹

##### 1.1 é’ˆå­”ç›¸æœºæ¨¡å‹

é€è§†æŠ•å½±åŸºäºé’ˆå­”ç›¸æœºæ¨¡å‹ï¼Œå…¶ä¸­æŠ•å½±ä¸­å¿ƒä½äºåŸç‚¹ï¼ŒæŠ•å½±å¹³é¢è·ç¦»åŸç‚¹ $d$ å•ä½ï¼š

$$\begin{align}
x' &= \frac{d \cdot x}{z} \\
y' &= \frac{d \cdot y}{z}
\end{align}$$

##### 1.2 é€è§†æŠ•å½±çŸ©é˜µ

æ ‡å‡†çš„é€è§†æŠ•å½±çŸ©é˜µä¸ºï¼š

$$P = \begin{bmatrix}
\frac{2n}{r-l} & 0 & \frac{r+l}{r-l} & 0 \\
0 & \frac{2n}{t-b} & \frac{t+b}{t-b} & 0 \\
0 & 0 & -\frac{f+n}{f-n} & -\frac{2fn}{f-n} \\
0 & 0 & -1 & 0
\end{bmatrix}$$

å…¶ä¸­ï¼š
- $(l, r)$ï¼šå·¦å³è¾¹ç•Œ
- $(b, t)$ï¼šä¸‹ä¸Šè¾¹ç•Œ  
- $(n, f)$ï¼šè¿‘è¿œå¹³é¢è·ç¦»

##### 1.3 è§†åœºè§’å½¢å¼çš„æŠ•å½±çŸ©é˜µ

æ›´å¸¸ç”¨çš„å½¢å¼ä½¿ç”¨è§†åœºè§’ $\text{fov}$ å’Œå®½é«˜æ¯” $\text{aspect}$ï¼š

$$P_{\text{perspective}} = \begin{bmatrix}
\frac{1}{\text{aspect} \cdot \tan(\text{fov}/2)} & 0 & 0 & 0 \\
0 & \frac{1}{\tan(\text{fov}/2)} & 0 & 0 \\
0 & 0 & -\frac{f+n}{f-n} & -\frac{2fn}{f-n} \\
0 & 0 & -1 & 0
\end{bmatrix}$$

#### 2. æ­£äº¤æŠ•å½±

##### 2.1 æ­£äº¤æŠ•å½±çš„ç‰¹ç‚¹

æ­£äº¤æŠ•å½±ä¿æŒå¹³è¡Œçº¿å¹³è¡Œï¼Œä¸äº§ç”Ÿé€è§†ç¼©çŸ­æ•ˆæœï¼š

$$P_{\text{orthographic}} = \begin{bmatrix}
\frac{2}{r-l} & 0 & 0 & -\frac{r+l}{r-l} \\
0 & \frac{2}{t-b} & 0 & -\frac{t+b}{t-b} \\
0 & 0 & -\frac{2}{f-n} & -\frac{f+n}{f-n} \\
0 & 0 & 0 & 1
\end{bmatrix}$$

#### 3. è§†å›¾å˜æ¢

##### 3.1 LookAtçŸ©é˜µçš„æ¨å¯¼

ç»™å®šç›¸æœºä½ç½® $\vec{e}$ã€ç›®æ ‡ç‚¹ $\vec{t}$ å’Œä¸Šå‘é‡ $\vec{u}$ï¼š

1. **è®¡ç®—ç›¸æœºåæ ‡ç³»åŸºå‘é‡ï¼š**

$$\begin{align}
\vec{f} &= \text{normalize}(\vec{t} - \vec{e}) \quad \text{(å‰å‘é‡)} \\
\vec{r} &= \text{normalize}(\vec{f} \times \vec{u}) \quad \text{(å³å‘é‡)} \\
\vec{u'} &= \vec{r} \times \vec{f} \quad \text{(ä¿®æ­£çš„ä¸Šå‘é‡)}
\end{align}$$

2. **æ„é€ è§†å›¾çŸ©é˜µï¼š**

$$V = \begin{bmatrix}
r_x & r_y & r_z & -\vec{r} \cdot \vec{e} \\
u'_x & u'_y & u'_z & -\vec{u'} \cdot \vec{e} \\
-f_x & -f_y & -f_z & \vec{f} \cdot \vec{e} \\
0 & 0 & 0 & 1
\end{bmatrix}$$

### å‘é‡è¿ç®—çš„å‡ ä½•åº”ç”¨

#### 1. å‘é‡å‰ç§¯çš„å‡ ä½•æ„ä¹‰

##### 1.1 å‰ç§¯çš„æ–¹å‘åˆ¤å®š

å¯¹äºäºŒç»´å‘é‡ï¼Œå‰ç§¯çš„ z åˆ†é‡è¡¨ç¤ºæ—‹è½¬æ–¹å‘ï¼š

$$\vec{a} \times \vec{b} = a_x b_y - a_y b_x$$

- è‹¥ç»“æœ > 0ï¼š$\vec{b}$ åœ¨ $\vec{a}$ çš„é€†æ—¶é’ˆæ–¹å‘
- è‹¥ç»“æœ < 0ï¼š$\vec{b}$ åœ¨ $\vec{a}$ çš„é¡ºæ—¶é’ˆæ–¹å‘
- è‹¥ç»“æœ = 0ï¼šä¸¤å‘é‡å…±çº¿

##### 1.2 åº”ç”¨ï¼šèƒŒé¢å‰”é™¤

åœ¨3Dæ¸²æŸ“ä¸­ï¼Œä½¿ç”¨æ³•å‘é‡çš„æ–¹å‘åˆ¤æ–­ä¸‰è§’å½¢æ˜¯å¦é¢å‘ç›¸æœºï¼š

$$\vec{n} = (\vec{v_1} - \vec{v_0}) \times (\vec{v_2} - \vec{v_0})$$

è‹¥ $\vec{n} \cdot \vec{v} < 0$ï¼ˆå…¶ä¸­ $\vec{v}$ æ˜¯è§†çº¿æ–¹å‘ï¼‰ï¼Œåˆ™ä¸‰è§’å½¢èƒŒå‘ç›¸æœºã€‚

#### 2. å‘é‡æŠ•å½±

##### 2.1 æ ‡é‡æŠ•å½±

å‘é‡ $\vec{a}$ åœ¨å‘é‡ $\vec{b}$ ä¸Šçš„æ ‡é‡æŠ•å½±ï¼š

$$\text{proj}_{\vec{b}} \vec{a} = \frac{\vec{a} \cdot \vec{b}}{|\vec{b}|}$$

##### 2.2 å‘é‡æŠ•å½±

å‘é‡ $\vec{a}$ åœ¨å‘é‡ $\vec{b}$ ä¸Šçš„å‘é‡æŠ•å½±ï¼š

$$\vec{p} = \frac{\vec{a} \cdot \vec{b}}{|\vec{b}|^2} \vec{b}$$

### æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯

#### 1. è¾¹ç•Œæ¡†ä¼˜åŒ–

åœ¨å…‰æ …åŒ–æ—¶ï¼Œé¦–å…ˆè®¡ç®—ä¸‰è§’å½¢çš„è¾¹ç•Œæ¡†æ¥å‡å°‘éœ€è¦æ£€æµ‹çš„åƒç´ æ•°é‡ï¼š

```cpp
void rasterizeTriangle(int x0, int y0, int x1, int y1, int x2, int y2,
                      const Color& c0, const Color& c1, const Color& c2) {
    // è®¡ç®—åŒ…å›´ç›’
    int minX = std::min(std::min(x0, x1), x2);
    int minY = std::min(std::min(y0, y1), y2);
    int maxX = std::max(std::max(x0, x1), x2);
    int maxY = std::max(std::max(y0, y1), y2);
    
    // é™åˆ¶åœ¨å±å¹•èŒƒå›´å†…
    minX = std::max(minX, 0);
    minY = std::max(minY, 0);
    maxX = std::min(maxX, SCREEN_WIDTH - 1);
    maxY = std::min(maxY, SCREEN_HEIGHT - 1);
    
    // é«˜æ•ˆæ‰¹é‡æ¸²æŸ“ - æ¸²æŸ“ä¼šè¯ç”±ä¸Šå±‚ç®¡ç†
    // åªæ£€æµ‹è¾¹ç•Œæ¡†å†…çš„åƒç´ 
    for (int y = minY; y <= maxY; y++) {
        for (int x = minX; x <= maxX; x++) {
            if (checkPointInTriangle(x, y, x0, y0, x1, y1, x2, y2)) {
                Color color = interpolateColor(x, y, x0, y0, c0, x1, y1, c1, x2, y2, c2);
                platform->setPixel(x, y, color);  // åœ¨æ¸²æŸ“ä¼šè¯å†…è‡ªåŠ¨é«˜æ•ˆ
            }
        }
    }
}
```

#### 2. å¢é‡è®¡ç®—ä¼˜åŒ–

åˆ©ç”¨é‡å¿ƒåæ ‡çš„çº¿æ€§æ€§è´¨ï¼Œå¯ä»¥ä½¿ç”¨å¢é‡è®¡ç®—æ¥ä¼˜åŒ–å†…å±‚å¾ªç¯ï¼š

```cpp
// é¢„è®¡ç®—é‡å¿ƒåæ ‡çš„å¢é‡
float dAlpha_dx = (y1 - y2) / (float)denom;
float dBeta_dx = (y2 - y0) / (float)denom;

for (int y = minY; y <= maxY; y++) {
    // è®¡ç®—è¡Œé¦–çš„é‡å¿ƒåæ ‡
    float alpha = ((y1 - y2)*(minX - x2) + (x2 - x1)*(y - y2)) / (float)denom;
    float beta = ((y2 - y0)*(minX - x2) + (x0 - x2)*(y - y2)) / (float)denom;
    
    for (int x = minX; x <= maxX; x++) {
        float gamma = 1.0f - alpha - beta;
        
        if (alpha >= 0 && beta >= 0 && gamma >= 0) {
            // æ’å€¼å¹¶ç»˜åˆ¶åƒç´ 
            Color color(alpha * c0.r + beta * c1.r + gamma * c2.r,
                       alpha * c0.g + beta * c1.g + gamma * c2.g,
                       alpha * c0.b + beta * c1.b + gamma * c2.b,
                       alpha * c0.a + beta * c1.a + gamma * c2.a);
            platform->setPixel(x, y, color);
        }
        
        // å¢é‡æ›´æ–°
        alpha += dAlpha_dx;
        beta += dBeta_dx;
    }
}
```

é€šè¿‡è¿™äº›æ•°å­¦æ¨å¯¼å’Œç®—æ³•ä¼˜åŒ–ï¼Œæˆ‘ä»¬çš„å›¾å½¢å­¦æ¼”ç¤ºç¨‹åºå±•ç¤ºäº†ä»åŸºç¡€çš„åƒç´ æ“ä½œåˆ°å¤æ‚çš„3DæŠ•å½±çš„å®Œæ•´æ¸²æŸ“ç®¡çº¿ã€‚

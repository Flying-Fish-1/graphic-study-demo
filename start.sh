#!/bin/bash

# 显示启动信息
echo "==========================================="
echo "     SDL 图形学演示程序启动脚本"
echo "==========================================="

# 检查构建目录是否存在，如果不存在则创建
if [ ! -d "build" ]; then
    echo "创建 build 目录..."
    mkdir -p build
fi

# 切换到构建目录
cd build

# 检查是否需要重新构建
if [ ! -f "graphic-study-demo" ] || [ "$(find ../src -name "*.cpp" -newer graphic-study-demo | wc -l)" -gt 0 ]; then
    echo "正在构建程序..."
    cmake ..
    make
    
    # 检查构建是否成功
    if [ $? -ne 0 ]; then
        echo "构建失败，请检查错误信息"
        exit 1
    fi
else
    echo "使用现有的构建结果..."
fi

# 运行程序
echo "启动程序..."
echo "---------------------------------------------"
echo "按 ESC 键或关闭窗口退出程序"
echo "---------------------------------------------"

# 使用当前终端运行程序
./graphic-study-demo

# 程序退出后显示信息
echo "---------------------------------------------"
echo "程序已退出"
echo "---------------------------------------------"